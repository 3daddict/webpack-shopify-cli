name: CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest # sets the version of linux we want to use, should be what you have on your server
    strategy:
      fail-fast: false # tells github to not run further steps if this one fails
      matrix:
        node-version: [14.x] # sets the version of node we want to use, should be what you have on your server
    steps:
      - uses: actions/checkout@v2 # fetches your commit to test it
      - name: Use Node.js ${{ matrix.node-version }} # names our step
        uses: actions/setup-node@v1 # downloads node and npm
        with:
          node-version: ${{ matrix.node-version }}
      - run: npm install # installs your dependencies
      - run: npm build # build your dist directory
        env:
          CI: true # shows terminal output!
  lhci:
    name: Lighthouse
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Lighthouse
        uses: shopify/lighthouse-ci-action@1.0
        with:
          theme_root: ./dist/
          store: ${{ secrets.SHOP_STORE }}
          access_token: ${{ secrets.SHOP_ACCESS_TOKEN }}
          lhci_github_app_token: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
          lhci_min_score_performance: 0.1
          lhci_min_score_accessibility: 0.1
